<!doctype html> <html lang=en-CA> <head> <meta charset=utf-8> <link href=../../../favicon.ico rel=icon> <meta content="width=device-width,initial-scale=1" name=viewport> <link href=../../../_app/immutable/assets/0.FB-WlhWB.css rel=stylesheet> <link href=../../../_app/immutable/entry/start.BXNIZPd7.js rel=modulepreload> <link href=../../../_app/immutable/chunks/DH4XaZMR.js rel=modulepreload> <link href=../../../_app/immutable/chunks/lpCv0clr.js rel=modulepreload> <link href=../../../_app/immutable/chunks/D0TfyVIA.js rel=modulepreload> <link href=../../../_app/immutable/chunks/sb3S253T.js rel=modulepreload> <link href=../../../_app/immutable/entry/app.DW2bk867.js rel=modulepreload> <link href=../../../_app/immutable/chunks/C1FmrZbK.js rel=modulepreload> <link href=../../../_app/immutable/chunks/BpAfFPH_.js rel=modulepreload> <link href=../../../_app/immutable/chunks/DoDgYtex.js rel=modulepreload> <link href=../../../_app/immutable/chunks/DXJHu1RR.js rel=modulepreload> <link href=../../../_app/immutable/chunks/BBlrOt-4.js rel=modulepreload> <link href=../../../_app/immutable/chunks/DFJTk0qQ.js rel=modulepreload> <link href=../../../_app/immutable/chunks/BdrA3JBu.js rel=modulepreload> <link href=../../../_app/immutable/chunks/BhbJ-8oC.js rel=modulepreload> <link href=../../../_app/immutable/nodes/0.B2gVevw6.js rel=modulepreload> <link href=../../../_app/immutable/chunks/EvTns6mg.js rel=modulepreload> <link href=../../../_app/immutable/chunks/nH7tL81h.js rel=modulepreload> <link href=../../../_app/immutable/chunks/MiRhU4Dk.js rel=modulepreload> <link href=../../../_app/immutable/chunks/CWkD3eWR.js rel=modulepreload> <link href=../../../_app/immutable/chunks/BbiwGLVK.js rel=modulepreload> <link href=../../../_app/immutable/chunks/nuwO2EZK.js rel=modulepreload> <link href=../../../_app/immutable/chunks/CE8kZ-92.js rel=modulepreload> <link href=../../../_app/immutable/chunks/rHoS4N2O.js rel=modulepreload> <link href=../../../_app/immutable/nodes/2.Cuno_vdp.js rel=modulepreload> <link href=../../../_app/immutable/chunks/DxNBuRgR.js rel=modulepreload> <link href=../../../_app/immutable/chunks/Bo8KcahP.js rel=modulepreload> <link href=../../../_app/immutable/chunks/BjEjrBPi.js rel=modulepreload> <link href=../../../_app/immutable/nodes/9.D1iP-L2T.js rel=modulepreload> <link href=../../../_app/immutable/chunks/BheWnx7M.js rel=modulepreload> <link href=../../../_app/immutable/chunks/CP8DixBa.js rel=modulepreload> <link href=../../../_app/immutable/chunks/Dwy0SrQy.js rel=modulepreload> <link href=../../../_app/immutable/chunks/cHA-g_NM.js rel=modulepreload> <link href=../../../_app/immutable/chunks/DSbNO6sC.js rel=modulepreload><!--[--><script> if (
      localStorage.getItem("mode") === "dark" ||
      (!("mode" in localStorage) &&
        !window.matchMedia("(prefers-color-scheme: light)").matches)
    ) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    } </script><!----><!--]--><!--[--><!--[--><!--]--> <!--[!--><!--]--> <meta content="Marc-Antoine Ouimet" property=og:site_name> <meta content=https://www.martyo256.github.io/en-CA/notes/examples/ocaml-tail-recursive-list-map property=og:url> <meta content=website property=og:type> <meta content="Tail-Recursive List Mapping Function in OCaml" property=og:title> <!--[!--><!--]--> <!--[!--><!--]--> <meta content=martyo256.github.io property=twitter:domain> <meta content=https://www.martyo256.github.io/en-CA/notes/examples/ocaml-tail-recursive-list-map property=twitter:url> <!--[--><meta content="Tail-Recursive List Mapping Function in OCaml" name=twitter:title><!--]--> <!--[!--><!--]--> <!--[!--><!--]--><!--]--><!--[--><!--[--><script async crossorigin=anonymous src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2206371749235959"> </script><!----><!--]--><!--]--><title>Tail-Recursive List Mapping Function in OCaml</title> </head> <body data-sveltekit-preload-data=hover> <div style=display:contents><!--[--><!--[--><!----><!--[!--><!--]--><!----> <div class=application-wrapper><!--[--><div class=header><div class=header-links-container><div class=header-links><a href=/en-CA class=no-underline><div class=logo><div class=logo-icon><svg height=1.2em viewBox="0 0 256 256" width=1.2em><path d="M48 48v160h32a8 8 0 0 1 0 16H40a8 8 0 0 1-8-8V40a8 8 0 0 1 8-8h40a8 8 0 0 1 0 16Zm168-16h-40a8 8 0 0 0 0 16h32v160h-32a8 8 0 0 0 0 16h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8" fill=currentColor></path></svg><!----></div> <div class=logo-text><span>Marc-Antoine</span> <span>Ouimet</span></div></div><!----></a> <!--[--><!--[--><a href=/en-CA class="btn hidden hover:btn-blue md:inline-flex"><!----><svg height=1.2em viewBox="0 0 256 256" width=1.2em><path d="M224 120v96a8 8 0 0 1-8 8h-56a8 8 0 0 1-8-8v-52a4 4 0 0 0-4-4h-40a4 4 0 0 0-4 4v52a8 8 0 0 1-8 8H40a8 8 0 0 1-8-8v-96a16 16 0 0 1 4.69-11.31l80-80a16 16 0 0 1 22.62 0l80 80A16 16 0 0 1 224 120" fill=currentColor></path></svg><!----> <span>Home</span></a><a href=/en-CA/notes class="btn hidden hover:btn-blue md:inline-flex"><!----><svg height=1.2em viewBox="0 0 256 256" width=1.2em><path d="M208 32H48a16 16 0 0 0-16 16v160a16 16 0 0 0 16 16h108.69a15.92 15.92 0 0 0 11.31-4.69L219.31 168a15.92 15.92 0 0 0 4.69-11.31V48a16 16 0 0 0-16-16M96 88h64a8 8 0 0 1 0 16H96a8 8 0 0 1 0-16m32 80H96a8 8 0 0 1 0-16h32a8 8 0 0 1 0 16m-32-32a8 8 0 0 1 0-16h64a8 8 0 0 1 0 16Zm64 68.69V160h44.7Z" fill=currentColor></path></svg><!----> <span>Notes</span></a><!--]--><!--]--></div> <div class=header-links><div class=lightswitch-track aria-checked=true aria-label="Set dark mode" role=switch tabindex=0 title="Set dark mode"><div class=lightswitch-thumb></div></div><!----> <button class="btn btn-blue !p-2"><svg height=1.2em viewBox="0 0 256 256" width=1.2em><path d="M228 128a12 12 0 0 1-12 12H40a12 12 0 0 1 0-24h176a12 12 0 0 1 12 12M40 76h176a12 12 0 0 0 0-24H40a12 12 0 0 0 0 24m176 104H40a12 12 0 0 0 0 24h176a12 12 0 0 0 0-24" fill=currentColor></path></svg><!----></button></div></div><!----></div><!--]--> <!--[--><div class=content-container><main><!----><div><!--[--><!--[--><!----><!--[--><!----><!----> <div class=heading-container><!--[!--><!--]--> <h1><!---->Tail-Recursive List Mapping Function in OCaml <span class="align-middle badge badge-yellow">Example</span><!----></h1></div><!----> <!----><!--[--><p>Implement the function <code class=inline-code><!---->map : ('a -> 'b) -> 'a list -> 'b list<!----><!----></code><!----> such that <code class=inline-code><!---->map f [x1; x2; ...; xn]<!----><!----></code><!----> is <code class=inline-code><!---->[f x1; f x2; ...; f xn]<!----><!----></code><!---->. Make sure that <code class=inline-code><!---->f x1<!----><!----></code><!---->, <code class=inline-code><!---->f x2<!----><!----></code><!---->, ..., <code class=inline-code><!---->f xn<!----><!----></code><!----> are computed in that order, and that the function is tail-recursive so that large input lists are supported.</p><!----><!--]--><!----> <hr class=rule><!----> <!--[!--><h5 class=italic><!---->Solution<!----></h5><!--]--> <!--[--><p>The function to implement is <code class=inline-code><!---->List.map<!----><!----></code><!----> from the standard library. We proceed recursively based on how the input list is constructed. To ensure that calls to <code class=inline-code><!---->f<!----><!----></code><!----> are made following the order of the input list, in the case where <code class=inline-code><!---->l = x :: xs<!----><!----></code><!---->, we first compute <code class=inline-code><!---->f x<!----><!----></code><!----> and then recursively compute <code class=inline-code><!---->map f xs<!----><!----></code><!---->.<div class=codeblock><header class=codeblock-header><div class=text-left><span class=codeblock-language>ocaml</span></div> <div class=text-center><!--[!--><!--]--></div> <div class=text-right><button class=codeblock-btn><!--[--><svg height=1.2em viewBox="0 0 256 256" width=1.2em class=me-2><path d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z" fill=currentColor></path></svg><!----> Copy<!--]--></button></div></header> <pre class="hljs codeblock-pre"><code class="hljs codeblock-code language-ocaml lineNumbers"><!----><span class=hljs-keyword>let</span> <span class=hljs-keyword>rec</span> map : (<span class=hljs-symbol>'a</span> -> <span class=hljs-symbol>'b</span>) -> <span class=hljs-symbol>'a</span> <span class=hljs-built_in>list</span> -> <span class=hljs-symbol>'b</span> <span class=hljs-built_in>list</span> =
  <span class=hljs-keyword>fun</span> f l ->
    <span class=hljs-keyword>match</span> l <span class=hljs-keyword>with</span>
    | <span class=hljs-literal>[]</span> -> <span class=hljs-literal>[]</span>
    | x :: xs ->
      <span class=hljs-keyword>let</span> y = f x <span class=hljs-keyword>in</span>
      <span class=hljs-keyword>let</span> ys = map f xs <span class=hljs-keyword>in</span>
      y :: ys
<!----><!----></code></pre></div><!----><p>This previous implementation is not tail-recursive because the call to <code class=inline-code><!---->map<!----><!----></code><!----> in <code class=inline-code><!---->map f xs<!----><!----></code><!----> does not occur in a tail position. Indeed, we need to perform the computation <code class=inline-code><!---->y :: ys<!----><!----></code><!----> after the recursive call, so we need a new stack frame for <code class=inline-code><!---->map f xs<!----><!----></code><!---->. However, it is worth noting that this function is tail-recursive modulo cons.<p>To implement the function tail-recursively, we introduce a helper function <code class=inline-code><!---->map_tl : ('a -> 'b) -> 'a list -> ('b list -> 'c) -> 'c<!----><!----></code><!----> in continuation-passing style. This helper function is such that <code class=inline-code><!---->map_tl f [x1; x2; ...; xn] return<!----><!----></code><!----> is <code class=inline-code><!---->return [f x1; f x2; ...; f xn]<!----><!----></code><!---->, with <code class=inline-code><!---->return : 'b list -> 'c<!----><!----></code><!----> being the continuation. We'll use this continuation to perform that previous <code class=inline-code><!---->y :: ys<!----><!----></code><!----> continuation.<div class=codeblock><header class=codeblock-header><div class=text-left><span class=codeblock-language>ocaml</span></div> <div class=text-center><!--[!--><!--]--></div> <div class=text-right><button class=codeblock-btn><!--[--><svg height=1.2em viewBox="0 0 256 256" width=1.2em class=me-2><path d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z" fill=currentColor></path></svg><!----> Copy<!--]--></button></div></header> <pre class="hljs codeblock-pre"><code class="hljs codeblock-code language-ocaml lineNumbers"><!----><span class=hljs-keyword>let</span> <span class=hljs-keyword>rec</span> map_tl : (<span class=hljs-symbol>'a</span> -> <span class=hljs-symbol>'b</span>) -> <span class=hljs-symbol>'a</span> <span class=hljs-built_in>list</span> -> (<span class=hljs-symbol>'b</span> <span class=hljs-built_in>list</span> -> <span class=hljs-symbol>'c</span>) -> <span class=hljs-symbol>'c</span> =
  <span class=hljs-keyword>fun</span> f l return ->
    <span class=hljs-keyword>match</span> l <span class=hljs-keyword>with</span>
    | <span class=hljs-literal>[]</span> -> return <span class=hljs-literal>[]</span>
    | x :: xs ->
      <span class=hljs-keyword>let</span> y = f x <span class=hljs-keyword>in</span>
      map_tl f xs (<span class=hljs-keyword>fun</span> ys -> return (y :: ys))

<span class=hljs-keyword>let</span> map : (<span class=hljs-symbol>'a</span> -> <span class=hljs-symbol>'b</span>) -> <span class=hljs-symbol>'a</span> <span class=hljs-built_in>list</span> -> <span class=hljs-symbol>'b</span> <span class=hljs-built_in>list</span> =
  <span class=hljs-keyword>fun</span> f l -> map_tl f l (<span class=hljs-keyword>fun</span> l' -> l')
<!----><!----></code></pre></div><!----><p>What we have done is effectively replace memory allocations from the stack to the heap by way of the continuation-passing style. If <code class=inline-code><!---->n<!----><!----></code><!----> is the length of the input list, then we need <code class=inline-code><!---->O(n)<!----><!----></code><!----> stack memory in the first implementation. On the other hand, we need <code class=inline-code><!---->O(n)<!----><!----></code><!----> heap memory to construct the continuation closures in the tail-recursive implementation.</p><!----><!--]--><!----><!----> <div class=ad-container><!--[--><!--[2--><ins class=adsbygoogle data-ad-client=ca-pub-2206371749235959 data-ad-format=fluid data-ad-layout=in-article data-ad-slot=2848674174 style=display:block;text-align:center></ins><!--]--><!--]--></div><!----><!----><!----><!--]--><!----><!--]--><!----><!--]--></div><!----><!----></main></div><!--]--> <!--[--><div class=footer><div class=footer-links><span><!---->© 2025 Marc-Antoine Ouimet<!----></span> <!--[--><!--[--><!--[!--><a href=/en-CA/notes/privacy-policy><!---->Privacy Policy<!----></a><!--]--><!--]--><!--]--></div> <div class=footer-links><!--[--><!--[--><!--[--><a href=https://github.com/MartyO256 class="btn btn-blue" rel=external target=_blank><!----><svg height=1.2em viewBox="0 0 512 512" width=1.2em><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.6 17.6 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4c0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5c-10.2-26.5-24.9-33.6-24.9-33.6c-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8c11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7c-49.7-5.8-102-25.5-102-113.5c0-25.1 8.7-45.6 23-61.6c-2.3-5.8-10-29.2 2.2-60.8a18.6 18.6 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.2 208.2 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.6 18.6 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8c14.3 16.1 23 36.6 23 61.6c0 88.2-52.4 107.6-102.3 113.3c8 7.1 15.2 21.1 15.2 42.5c0 30.7-.3 55.5-.3 63c0 5.4 3.1 11.5 11.4 11.5a19.4 19.4 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7C480 134.9 379.7 32 256 32" fill=currentColor></path></svg><!----> <span>GitHub</span></a><!--]--><!--[--><a href=https://www.linkedin.com/in/marc-antoine-ouimet class="btn btn-blue" rel=external target=_blank><!----><svg height=1.2em viewBox="0 0 512 512" width=1.2em><path d="M444.17 32H70.28C49.85 32 32 46.7 32 66.89v374.72C32 461.91 49.85 480 70.28 480h373.78c20.54 0 35.94-18.21 35.94-38.39V66.89C480.12 46.7 464.6 32 444.17 32m-273.3 373.43h-64.18V205.88h64.18ZM141 175.54h-.46c-20.54 0-33.84-15.29-33.84-34.43c0-19.49 13.65-34.42 34.65-34.42s33.85 14.82 34.31 34.42c-.01 19.14-13.31 34.43-34.66 34.43m264.43 229.89h-64.18V296.32c0-26.14-9.34-44-32.56-44c-17.74 0-28.24 12-32.91 23.69c-1.75 4.2-2.22 9.92-2.22 15.76v113.66h-64.18V205.88h64.18v27.77c9.34-13.3 23.93-32.44 57.88-32.44c42.13 0 74 27.77 74 87.64Z" fill=currentColor></path></svg><!----> <span>LinkedIn</span></a><!--]--><!--[!--><a href=mailto:ouimetmarcantoine@gmail.com class="btn btn-blue"><!----><svg height=1.2em viewBox="0 0 24 24" width=1.2em><g fill=currentColor><path d="M22 7.535V17a3 3 0 0 1-2.824 2.995L19 20H5a3 3 0 0 1-2.995-2.824L2 17V7.535l9.445 6.297l.116.066a1 1 0 0 0 .878 0l.116-.066z"></path><path d="M19 4c1.08 0 2.027.57 2.555 1.427L12 11.797l-9.555-6.37a3 3 0 0 1 2.354-1.42L5 4z"></path></g></svg><!----> <span>Email</span></a><!--]--><!--]--><!--]--></div> <div class=footer-links><!--[--><!--[--><div class="btn btn-gray disabled"><span><svg height=1.2em viewBox="0 0 256 256" width=1.2em><path d="m181.66 133.66l-80 80A8 8 0 0 1 88 208V48a8 8 0 0 1 13.66-5.66l80 80a8 8 0 0 1 0 11.32" fill=currentColor></path></svg><!----></span> <span>English</span></div><!--]--><!--[!--><a href=/fr-CA class="btn btn-blue">Français</a><!--]--><!--]--></div><!----></div><!--]--></div><!----><!----><!--]--> <!--[!--><!--]--><!--]--> <script> {
					__sveltekit_81yxi = {
						base: new URL("../../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../../_app/immutable/entry/start.BXNIZPd7.js"),
						import("../../../_app/immutable/entry/app.DW2bk867.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 9],
							data: [null,null,null],
							form: null,
							error: null
						});
					});
				} </script> </div> 